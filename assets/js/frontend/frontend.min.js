"use strict";jQuery(document).ready(function(i){var n=[],r=!1,a=!1,o=!1,d="sveawebpay_invoice",l="sveawebpay_part_pay",c=i('[name="payment_method"]:checked').val()||!1,g=i('[name="billing_country"]').val()||!1,m=(void 0!==Svea.sameShippingAsBilling[c]&&Svea.sameShippingAsBilling[c]&&i(".woocommerce form.woocommerce-checkout").addClass("hide-shipping-fields"),0!=Svea.onlyOneAllowedCountry&&(g=Svea.onlyOneAllowedCountry),Svea.isPayPage&&(g=Svea.customerCountry,i(".payment_methods, .svea-get-address-button-container").addClass("is-pay-page")),i(".payment_methods, .svea-get-address-button-container").addClass("payment-method-"+c).addClass("country-"+(g?g.toLowerCase():"false")),!1);function _(e){if(e.length<=0)return"";for(var s="",t=0;t<e.length;++t){var a=e[t];s+='<option value="'+a.addressSelector+'">',"business"==a.customerType.toLowerCase()?s+=a.fullName+", ":"person"==a.customerType.toLowerCase()&&(s+=a.lastName+", "+a.firstName+" "),s+=a.street+" "+a.zipCode+" "+a.locality+"</option>"}return s}function v(e){0<String(e.firstName).length&&i("#billing_first_name").val(String(e.firstName)).change().trigger("keydown"),0<String(e.lastName).length&&i("#billing_last_name").val(String(e.lastName)).change().trigger("keydown"),"business"==String(e.customerType).toLowerCase()&&i("#billing_company").val(String(e.fullName)).change().trigger("keydown"),0<String(e.street).length&&i("#billing_address_1").val(String(e.street)).change().trigger("keydown"),0<String(e.coAddress).length&&i("#billing_address_2").val(String(e.coAddress)).change().trigger("keydown"),0<String(e.zipCode).length&&i("#billing_postcode").val(String(e.zipCode)).change().trigger("keydown"),0<String(e.locality).length&&i("#billing_city").val(String(e.locality)).change().trigger("keydown"),0<String(e.phoneNumber).length&&i("#billing_phone").val(String(e.phoneNumber)).change().trigger("keydown"),a=!0}function u(e){e?(i("#billing_address_1, #billing_address_2, #billing_postcode, \t\t\t\t#billing_city").prop("readonly",!1),i("#billing_address_1, #billing_address_2, #billing_postcode, \t\t\t\t#billing_city").removeClass("disabled-input")):(i("#billing_address_1, #billing_address_2, \t\t\t\t#billing_postcode, #billing_city").prop("readonly",!0),i("#billing_address_1, #billing_address_2, \t\t\t\t#billing_postcode, #billing_city").addClass("disabled-input"))}function b(e,s,t){switch(e){case"SE":case"DK":switch(s){case d:if("individual"===t)return;break;case l:return}}return 1}function u(e){e?(i("#billing_first_name, #billing_last_name, #billing_address_1, \t\t\t\t#billing_address_2, #billing_postcode, #billing_city").prop("readonly",!1),i("#billing_first_name, #billing_last_name, #billing_address_1, \t\t\t\t#billing_address_2, #billing_postcode, #billing_city").removeClass("disabled-input")):(i("#billing_first_name, #billing_last_name, #billing_address_1, \t\t\t\t#billing_address_2, #billing_postcode, #billing_city").prop("readonly",!0),i("#billing_first_name, #billing_last_name, #billing_address_1, \t\t\t\t#billing_address_2, #billing_postcode, #billing_city").addClass("disabled-input"))}function p(){i("#billing_first_name, #billing_last_name, #billing_address_1, \t\t\t\t#billing_address_2, #billing_postcode, #billing_city").val([])}0<i(".svea-get-address-button-container.get-address-shortcode").length&&(i(".payment_method_"+d).is(":visible")?i(".svea-get-address-button-container.get-address-shortcode").removeClass("invoice-not-available"):i(".svea-get-address-button-container.get-address-shortcode").addClass("invoice-not-available")),i(".svea-get-address-button-container.get-address-shortcode").is(":visible")&&(m=i("[name='svea_get_address_customer_type']:checked").val(),i('[name="iv_billing_customer_type"]').val(m),i(".payment_methods, .svea-get-address-button-container").addClass("customer-type-"+m)),b(g,c,m)?b(g,c,m)&&u(!0):(u(!1),a||p()),i(document).on("change",".woocommerce form.woocommerce-checkout .woocommerce-billing-fields :input",function(e){a=!1}),i(document).on("keydown",'[name="svea_billing_ssn"], [name="svea_billing_org_number"], [name="iv_billing_org_number"], [name="iv_billing_ssn"], [name="pp_billing_ssn"]',function(e){var s=i(e.target);13==(e.which||e.keyCode||0)&&(e.preventDefault(),(e=($container=s.closest(".svea-fields, .svea-get-address-button-container")).find(".svea-get-address-button")).is(":visible"))&&e.click()}),i(document).on("change",'[name="svea_billing_ssn"]',function(e){i("[name='iv_billing_ssn'], [name='pp_billing_ssn']").val(i(this).val())}),i(document).on("change",'[name="svea_billing_org_number"]',function(e){i("[name='iv_billing_org_number'], [name='pp_billing_org_number']").val(i(this).val())}),i(document).on("click",".svea-get-address-button",function(e){e.preventDefault();var s,e=c,t=(i(this),i(this).closest(".svea-get-address-button-container")),a=i(".svea-get-address-button-container.get-address-shortcode").is(":visible");i(".svea-invoice-fields, .svea-part-pay-fields");o||(a&&(e=d),"individual"==m||e==l?(s=i(a?"[name='svea_billing_ssn']":"[name='"+(e==d?"iv":"pp")+"_billing_ssn']").val(),t.addClass("getting-address"),o=!0,i.post(Svea.ajaxUrl,{action:"svea_get_address",pers_nr:s,country_code:g,payment_type:e,security:Svea.gaSecurity},function(e){t.removeClass("getting-address"),o=!1,void 0===e.resultcode||void 0===e.customerIdentity?(t.append('<div class="svea-message error">'+Phrases.could_not_get_address+"</div>"),t.addClass("getting-address-error"),setTimeout(function(){t.find(".svea-message.error").remove(),t.removeClass("getting-address-error")},5e3)):"Error"==e.resultcode||"NoSuchEntity"==e.resultcode?(t.append('<div class="svea-message error">'+e.errormessage+"</div>"),t.addClass("getting-address-error"),setTimeout(function(){t.find(".svea-message.error").remove(),t.removeClass("getting-address-error")},5e3)):(v(e.customerIdentity[0]),t.append('<div class="svea-message success">'+Phrases.your_address_was_found+"</div>"),t.addClass("getting-address-success"),setTimeout(function(){t.find(".svea-message.success").remove(),t.removeClass("getting-address-success")},5e3))})):"company"==m&&(s=i(a?"[name='svea_billing_org_number']":"[name='"+(e==d?"iv":"pp")+"_billing_org_number']").val(),t.addClass("getting-address"),o=!0,i.post(Svea.ajaxUrl,{action:"svea_get_address",org_nr:s,country_code:g,payment_type:e,security:Svea.gaSecurity},function(e){t.removeClass("getting-address"),o=!1,void 0===e.resultcode||void 0===e.customerIdentity?(t.append('<div class="svea-message error">'+Phrases.could_not_get_address+"</div>"),t.addClass("getting-address-error"),setTimeout(function(){t.find(".svea-message.error").remove(),t.removeClass("getting-address-error")},5e3)):"Error"==e.resultcode||"NoSuchEntity"==e.resultcode?(t.append('<div class="svea-message error">'+e.errormessage+"</div>"),t.addClass("getting-address-error"),setTimeout(function(){t.find(".svea-message.error").remove(),t.removeClass("getting-address-error")},5e3)):(e=e.customerIdentity,i(".org-address-selector").html(_(e)),n=e,i(".address-selector").val(e[0].addressSelector),v(e[0]),r=e[0],t.addClass("getting-address-success"),t.append('<div class="svea-message success">'+Phrases.your_address_was_found+"</div>"),setTimeout(function(){t.find(".svea-message.success").remove(),t.removeClass("getting-address-success")},5e3))})))}),Svea.isPayPage&&i('.payment_methods [name="payment_method"]').on("change",function(){var e=c||!1;c=i('[name="payment_method"]:checked').val(),m=i('[name="iv_billing_customer_type"]').val()||!1,i(".payment_methods, .svea-get-address-button-container").removeClass("payment-method-"+e).addClass("payment-method-"+c).removeClass("customer-type-"+m).addClass("customer-type-"+m),r=!1,n=[],i(".org-address-selector").html("")}),i(document).on("updated_checkout",function(){0<i(".svea-get-address-button-container.get-address-shortcode").length&&(i(".payment_method_"+d).is(":visible")?i(".svea-get-address-button-container.get-address-shortcode").removeClass("invoice-not-available"):i(".svea-get-address-button-container.get-address-shortcode").addClass("invoice-not-available")),i(".svea-get-address-button-container.get-address-shortcode").is(":visible")&&(i("[name='iv_billing_ssn'], [name='pp_billing_ssn']").val(i("[name='svea_billing_ssn']").val()),i("[name='iv_billing_org_number']").val(i("[name='svea_billing_org_number']").val()),i('[name="iv_billing_customer_type"]').val(i('[name="svea_get_address_customer_type"]:checked').val()));var e=g||!1,s=c||!1,t=m||!1;0==Svea.onlyOneAllowedCountry&&(g=i('[name="billing_country"]').val()),c=i('[name="payment_method"]:checked').val(),m=i('[name="iv_billing_customer_type"]').val()||!1,i(".payment_methods, .svea-get-address-button-container").removeClass("country-"+(e?e.toLowerCase():"false")).addClass("country-"+(g?g.toLowerCase():"false")).removeClass("payment-method-"+s).addClass("payment-method-"+c),i(".svea-get-address-button-container.get-address-shortcode").is(":visible")&&(m=i('[name="iv_billing_customer_type"]').val()||!1),i(".payment_methods, .svea-get-address-button-container").removeClass("customer-type-"+t).addClass("customer-type-"+m),!1!==r&&0<n.length&&(i(".org-address-selector").html(_(n)),i(".org-address-selector").val(r.addressSelector),i(".address-selector").val(r.addressSelector)),void 0!==Svea.sameShippingAsBilling[c]&&Svea.sameShippingAsBilling[c]?i(".woocommerce .woocommerce-checkout").hasClass("hide-shipping-fields")||i(".woocommerce .woocommerce-checkout").addClass("hide-shipping-fields"):i(".woocommerce .woocommerce-checkout").hasClass("hide-shipping-fields")&&i(".woocommerce .woocommerce-checkout").removeClass("hide-shipping-fields"),e===g&&c===s||(r=!1,n=[],i(".org-address-selector").html(""),b(g,c,m)?b(g,c,m)&&u(!0):(u(!1),a||p()))}),i(document).on("change",'[name="payment_method"]',function(){i("body").trigger("update_checkout")}),i(document).on("change",'[name="billing_country"]',function(){var e=g||!1;g=i('[name="billing_country"]').val(),i(".payment_methods, .svea-get-address-button-container").removeClass("country-"+(e?e.toLowerCase():"false")).addClass("country-"+(g?g.toLowerCase():"false")),b(g,c,m)?b(g,c,m)&&u(!0):(u(!1),a||p())});var s=null;i(document).on("change",'[name="iv_billing_customer_type"], [name="svea_get_address_customer_type"]',function(){var e;o?null!=s&&i(this).val(s.val()):(e=m||!1,m=i(this).val()||!1,i(".payment_methods, .svea-get-address-button-container").removeClass("customer-type-"+e).addClass("customer-type-"+m),s=i(this),b(g,c,m)?b(g,c,m)&&u(!0):(u(!1),a||p()))}),i(document).on("change",'[name="svea_get_address_customer_type"]',function(){i("[name='iv_billing_customer_type']").val(i(this).val()),s=i(this),i("body").trigger("update_checkout")}),i(document).on("change",".org-address-selector",function(){for(var e=0;e<n.length;++e){var s=n[e];if(s.addressSelector==i(".org-address-selector").val())return i(".address-selector").val(i(".org-address-selector").val()),v(s),void(r=s)}}),i(document).on("change",".birth-date-month, .birth-date-day, .birth-date-year",function(){var e=i(this).parents(".svea-part-pay-fields, .svea-invoice-fields"),s=parseInt(e.find(".birth-date-year").val()),t=parseInt(e.find(".birth-date-month").val()),a=parseInt(e.find(".birth-date-day").val()),n=new Date(s,t,0).getDate();e.find(".birth-date-day option").each(function(){parseInt(i(this).val())>n?i(this).prop("disabled",!0):i(this).prop("disabled",!1)}),n<a&&e.find(".birth-date-day").val(n)})});